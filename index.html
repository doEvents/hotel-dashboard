<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Stok Dinamis 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border: none; border-radius: 12px; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div id="loader" class="loading-overlay flex-column">
    <div class="spinner-border text-primary mb-2"></div>
    <span>Menghubungkan ke Google Sheets...</span>
</div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-dark"><i class="bi bi-database-fill-gear text-primary"></i> Inventory Manager</h2>
                <span class="badge bg-white text-dark shadow-sm border py-2 px-3">Status: <span class="text-success">Online</span></span>
            </div>

            <div class="card shadow-sm p-4 mb-4">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label small fw-bold">Nama Barang</label>
                        <input type="text" id="itemName" class="form-control" placeholder="Contoh: Laptop Asus">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small fw-bold">Stok</label>
                        <input type="number" id="itemQty" class="form-control" placeholder="0">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold">Kategori</label>
                        <select id="itemCat" class="form-select">
                            <option value="Elektronik">Elektronik</option>
                            <option value="Alat Kantor">Alat Kantor</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button onclick="tambahBarang()" class="btn btn-sm btn-primary shadow-sm w-100 py-2">
                            <i class="bi bi-plus-circle me-1"></i> Tambah Barang
                        </button>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm overflow-hidden">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">Nama Barang</th>
                                <th>Jumlah</th>
                                <th>Kategori</th>
                                <th class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="contentTable">
                            </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>



<script>
    // KONFIGURASI: Ganti dengan URL Apps Script Anda
    const SCRIPT_URL = 'URL_WEB_APP_ANDA';
    const SHEET_NAME = 'StokUtama';

    // Helper Fungsi untuk API
    async function callAPI(action, data = {}) {
        document.getElementById('loader').style.display = 'flex';
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action, sheetName: SHEET_NAME, data })
            });
            return await response.json();
        } catch (e) {
            console.error(e);
            alert("Gagal terhubung ke server!");
        } finally {
            document.getElementById('loader').style.display = 'none';
        }
    }

    // Fungsi Muat Data (Read)
    async function muatData() {
        const data = await callAPI('read');
        const tbody = document.getElementById('contentTable');
        tbody.innerHTML = '';

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">Belum ada data barang.</td></tr>';
            return;
        }

        data.forEach(item => {
            tbody.innerHTML += `
                <tr>
                    <td class="ps-4 fw-medium">${item.Nama}</td>
                    <td><span class="badge bg-info-subtle text-info border border-info-subtle px-3">${item.Jumlah}</span></td>
                    <td><span class="text-muted small">${item.Kategori}</span></td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-danger border-0" onclick="hapusBarang('${item.Nama}')">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                </tr>
            `;
        });
    }

    // Fungsi Tambah (Create)
    async function tambahBarang() {
        const payload = {
            "Nama": document.getElementById('itemName').value,
            "Jumlah": document.getElementById('itemQty').value,
            "Kategori": document.getElementById('itemCat').value,
            "WaktuUpdate": new Date().toLocaleString('id-ID')
        };

        if(!payload.Nama || !payload.Jumlah) return alert("Lengkapi data!");

        const res = await callAPI('add', payload);
        if(res.status === 'success') {
            document.getElementById('itemName').value = '';
            document.getElementById('itemQty').value = '';
            muatData();
        }
    }

    // Fungsi Hapus (Delete)
    async function hapusBarang(id) {
        if(confirm(`Hapus ${id} dari stok?`)) {
            const res = await callAPI('delete', { id: id });
            if(res.status === 'success') muatData();
        }
    }

    // Jalankan saat startup
    window.onload = muatData;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
